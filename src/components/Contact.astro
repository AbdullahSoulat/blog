---
import Section from './Section.astro';
---

<Section>
	<form method="post" id="contact-form" name="contact" class="flex flex-col gap-3">
		<p >
			<label class="flex flex-col gap-2">Email Address
				<input
					required
					type="email"
					name="email"
					placeholder="e.g. johndoe@gmail.com"
					class="w-full border-2 px-4 py-2 bg-neutral-200 dark:bg-neutral-700
						   dark:border-white"
				/>
			</label>
		</p>
		<p>
			<button 
				type="submit" id="submit-button"
				class="bg-neutral-950 text-white px-8 py-2 hover:cursor-pointer hover:bg-blue-300
					   w-full md:w-auto dark:bg-neutral-50 dark:text-black"
			>Send</button>
		</p>
	</form>

	<!-- Success popup (hidden by default) -->
	<div id="success-popup" class="hidden fixed inset-0 flex items-center justify-center z-50 bg-black/60">
		<div class="bg-white text-black flex flex-col gap-2 py-8 px-10">
			<p class="mb-6">Form submitted successfully</p>
			<button 
				id="close-popup" 
				class="bg-black px-6 py-2 text-white hover:bg-neutral-600 hover:cursor-pointer"
			>Close</button>
		</div>
	</div>

	<!-- Loading Screen -->
	<div id="loading-popup" class="hidden fixed inset-0 flex items-center justify-center z-50 bg-black/60">
		<div class="flex flex-col bg-white text-black px-12 py-8 justify-center items-center">
			<p class="mb-6">Submitting Form</p>
			<div class="loader"></div>
		</div>
	</div>
</Section>

<style>
.loader {
  border: 6px solid #f3f3f3; /* Light grey */
  border-top: 6px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>


<script>
	const form = document.getElementById("contact-form") as HTMLFormElement;
	const successMessage = document.getElementById("success-popup");
	const closeMessage = document.getElementById("close-popup");
	const loadingScreen = document.getElementById("loading-popup");

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		e.stopPropagation();

		loadingScreen?.classList.remove("hidden");

		try {
     		const formData = new FormData(form);
      		const response = await fetch('/api/contact', {
       		method: 'POST',
       		body: formData
      	});
      
      	const result = await response.json();
	  	console.log(result);
     
    	if (response.ok) {
			loadingScreen?.classList.add("hidden");
			successMessage?.classList.remove("hidden");
       		form.reset(); // Clear the form
	  	}
    	} catch (error) {
			alert("Submission Failed!");
		}
	})

	closeMessage?.addEventListener('click', () => {
		successMessage?.classList.add("hidden");
	})
</script>